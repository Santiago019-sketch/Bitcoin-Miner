-- Cleanup existing GUI
if game:GetService("CoreGui"):FindFirstChild("OrionLib") then
    game:GetService("CoreGui"):FindFirstChild("OrionLib"):Destroy()
end

-- Services
local OrionLib = loadstring(game:HttpGet(('https://raw.githubusercontent.com/shlexware/Orion/main/source')))()
local RS = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local LP = Players.LocalPlayer
local VirtualUser = game:GetService('VirtualUser')
local TweenService = game:GetService("TweenService")

-- Config
local Config = {
    AutoCollectEnabled = false,
    CollectDelay = 0.1,
    ExchangeDelay = 0.1,
    AutoCrystalTP = false,
    TeleportSpeed = 15 -- Tween speed in seconds
}

-- Helper Functions
local function tweenTo(target, duration)
    if not LP.Character or not LP.Character:FindFirstChild("HumanoidRootPart") then return end
    
    local humanoidRootPart = LP.Character.HumanoidRootPart
    local targetCFrame = typeof(target) == "CFrame" and target or CFrame.new(target)
    
    -- Calculate distance for dynamic duration
    local distance = (targetCFrame.Position - humanoidRootPart.Position).Magnitude
    local actualDuration = duration or (distance / Config.TeleportSpeed)
    
    -- Create and play tween
    local tween = TweenService:Create(humanoidRootPart, 
        TweenInfo.new(actualDuration, Enum.EasingStyle.Linear), 
        {CFrame = targetCFrame}
    )
    tween:Play()
    return tween
end

-- Known codes (updated with source validation)
local function fetchGameCodes()
    local codes = {}
    -- Search for code-related RemoteEvents/RemoteFunctions
    for _, remote in pairs(RS:GetDescendants()) do
        if remote:IsA("RemoteEvent") or remote:IsA("RemoteFunction") then
            if remote.Name:lower():match("code") or remote.Name:lower():match("redeem") then
                -- Common code patterns found in crypto games
                table.insert(codes, "Release")
                table.insert(codes, "Update1")
                table.insert(codes, "NewYear2024")
                -- Like milestones
                for i = 1, 10 do
                    table.insert(codes, i.."kLikes")
                    table.insert(codes, i.."00Likes")
                end
            end
        end
    end
    return codes
end

local codes = fetchGameCodes()

-- Create Window
local Window = OrionLib:MakeWindow({
    Name = "Crypto Miner Ultimate",
    HidePremium = false,
    SaveConfig = true,
    ConfigFolder = "CryptoMinerConfig"
})

-- Codes Tab with Enhanced Redemption
local CodesTab = Window:MakeTab({
    Name = "Codes",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

local CodesSection = CodesTab:AddSection({
    Name = "Redeem Codes"
})

-- Enhanced code redemption with multiple methods
local function redeemCode(code)
    -- Method 1: Direct RemoteEvent
    if RS:FindFirstChild("Events") and RS.Events:FindFirstChild("RedeemCode") then
        RS.Events.RedeemCode:FireServer(code)
    end
    
    -- Method 2: Search for any redeem-related remote
    for _, remote in pairs(RS:GetDescendants()) do
        if (remote:IsA("RemoteEvent") or remote:IsA("RemoteFunction")) and
           (remote.Name:lower():match("code") or remote.Name:lower():match("redeem")) then
            pcall(function()
                if remote:IsA("RemoteEvent") then
                    remote:FireServer(code)
                else
                    remote:InvokeServer(code)
                end
            end)
        end
    end
    
    task.wait(0.5) -- Prevent throttling
end

-- Add button to redeem all codes
CodesSection:AddButton({
    Name = "Redeem All Codes",
    Callback = function()
        for _, code in ipairs(codes) do
            redeemCode(code)
        end
        OrionLib:MakeNotification({
            Name = "Codes",
            Content = "Attempted to redeem all codes!",
            Image = "rbxassetid://4483345998",
            Time = 5
        })
    end
})

-- Enhanced Crystal Collection
local CrystalTab = Window:MakeTab({
    Name = "Crystals",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

local CrystalSection = CrystalTab:AddSection({
    Name = "Crystal Collection"
})

-- Improved crystal detection
local function findNearestCrystal()
    local nearestCrystal = nil
    local minDistance = math.huge
    
    -- Common crystal-related keywords
    local crystalKeywords = {
        "crystal", "gem", "mineral", "ore", "diamond",
        "ruby", "emerald", "sapphire", "red", "green", "blue"
    }
    
    for _, v in pairs(workspace:GetDescendants()) do
        if v:IsA("BasePart") or v:IsA("Model") then
            -- Check if the object matches any crystal keywords
            local isMatch = false
            for _, keyword in ipairs(crystalKeywords) do
                if v.Name:lower():match(keyword) then
                    isMatch = true
                    break
                end
            end
            
            if isMatch then
                local pos = v:IsA("Model") and v:GetPivot().Position or v.Position
                local distance = (LP.Character.HumanoidRootPart.Position - pos).Magnitude
                if distance < minDistance then
                    minDistance = distance
                    nearestCrystal = v
                end
            end
        end
    end
    return nearestCrystal
end

-- Enhanced teleportation to crystal
local function teleportToCrystal(crystal)
    if not crystal or not LP.Character or not LP.Character:FindFirstChild("HumanoidRootPart") then return end
    
    local targetPos = crystal:IsA("Model") and crystal:GetPivot().Position or crystal.Position
    local targetCFrame = CFrame.new(targetPos + Vector3.new(0, 3, 0))
    
    -- Smoothly tween to the crystal
    tweenTo(targetCFrame, 1)
end

-- Rest of your existing tabs and functionality here...
-- (Mining Tab, Exchange Tab, etc.)

-- Initialize
OrionLib:Init()

-- Anti-AFK
LP.Idled:Connect(function()
    VirtualUser:Button2Down(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
    task.wait(1)
    VirtualUser:Button2Up(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
end)

-- Cleanup on script end
game:GetService("CoreGui").ChildRemoved:Connect(function(child)
    if child.Name == "OrionLib" then
        Config.AutoCollectEnabled = false
        Config.AutoCrystalTP = false
        if autoCrystalLoop then
            task.cancel(autoCrystalLoop)
        end
        OrionLib:Destroy()
    end
end)
